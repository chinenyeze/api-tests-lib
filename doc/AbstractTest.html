<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Perkbox QA Library</title>
    <link rel="icon" type="image/png" href="https://d33e3vv6sjfy9c.cloudfront.net/assets/meta/favicon-white-32x32-ea7672b223119f07d17a6f64b032e3db61c24164ea80267a9c5f82e82eed1aec.png" sizes="32x32">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div id="container">
    <h1>Perkbox QA Library</h1>
    <small class="menu"><< <a href="Documentation.html#abstractTest">Home menu</a></small>


    <h2>AbstractTest</h2>
    <small>Package: <code>com.perkbox.testbase</code></small>

    <br><br>
    <small>
        The <code>AbstractTest</code> class can be extended by test classes and its methods can be used as helpers for making HTTP requests, as shown in this documentation page.
    </small>


    <h3>Instance Methods</h3>


    <h4>
        <a name="AbstractTest">public AbstractTest(String endpoint, String jsonData)</a>
        <button onclick="gotoSrc('L21-L23')">src</button>
    </h4>
    <small>
        <i>Constructor:</i> which requires an <code>endpoint</code> argument (used for the resource path and token generation) and a <code>jsonData</code> argument (used to specify the json file used for the tests, e.g. used for request body).
        This constructor can be used within your test class by extending <code>AbstractTest</code> class and calling the <code>super(..)</code> keyword. E.g. the snippet below illustrates the use of the constructor in <code>GetQuestion</code> test class.
    </small>
    <pre>
        public class GetQuestion extends AbstractTest {

            public GetQuestion() {
                super("questions", "questions/question");
            }
        }
    </pre>


    <h4>
        <a name="AbstractTest_logLevel">public AbstractTest(String endpoint, String jsonData, int logLevel)</a>
        <button onclick="gotoSrc('L25-L31')">src</button>
    </h4>
    <small>
        <i>Constructor:</i> which also achieves same function as <code><a href="#AbstractTest">public AbstractTest(String endpoint, String jsonData)</a></code> constructor, however, requires a <code>logLevel</code>.
        The <code>logLevel</code> specifies the kind/level of logs to target for a request. The log levels are:
        <ul>
            <li>LOG_NONE: disables logging</li>
            <li>LOG_GET: logs request and response for GET requests only</li>
            <li>LOG_POST: logs request and response for POST requests only</li>
            <li>LOG_PUT: logs request and response for PUT requests only</li>
            <li>LOG_PATCH: logs request and response for PATCH requests only</li>
            <li>LOG_ALL: logs request and response for all requests</li>
        </ul>
    </small>
    <pre>
        public class GetQuestion extends AbstractTest {

            public GetQuestion() {
                super("questions", "questions/question", LOG_ALL);
            }
        }
    </pre>


    <h4>
        <a name="get">public Responses get(String uuid)</a>
        <button onclick="gotoSrc('L33-L35')">src</button>
    </h4>
    <small>
        This method is used to issue a get request on a resource using its <code>uuid</code> and the appropriate valid read token.
        This method returns a <code>Responses</code> object.
    </small>
    <pre>
        public class GetQuestion extends AbstractTest {

            public GetQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void validGet() {
                Responses response = get("06920c43-1349-4485-b616-1a9da42c1b64");
                response.assertTrue(200);
            }
        }
    </pre>


    <h4>
        <a name="get_token">public Responses get(String uuid, String token)</a>
        <button onclick="gotoSrc('L37-L43')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#get">public Responses get(String uuid)</a></code>, however it also provides a second parameter to specify the <code>token</code> used to make the request.
    </small>
    <pre>
        public class GetQuestion extends AbstractTest {

            public GetQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void createOnlyTokenShouldError() {
                Responses response = get("06920c43-1349-4485-b616-1a9da42c1b64", Token.create("questions"));
                response.assertTrue(403, "\"code\":\"PBERR000x789\"");
            }
        }
    </pre>


    <h4>
        <a name="getEtag">public String getEtag(String uuid)</a>
        <button onclick="gotoSrc('L45-L47')">src</button>
    </h4>
    <small>This method is used to get the Etag of a resource by issuing a get request on its <code>uuid</code>.</small>
    <pre>
        public class GetQuestion extends AbstractTest {

            public GetQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void etagMustBePresent() {
                String etag = getEtag("06920c43-1349-4485-b616-1a9da42c1b64");
                Assert.assertNotNull(etag);
            }
        }
    </pre>


    <h4>
        <a name="list">public Requests list()</a>
        <button onclick="gotoSrc('L49-L51')">src</button>
    </h4>
    <small>
        This method is used to issue a get request for obtaining a list of resources.
        Unlike <code>get</code>, <code>create</code>, <code>update</code> and <code>patch</code>, the <code>list</code> method returns a <code>Requests</code> object.
        This means <code>.get()</code> needs to be called in order to send the request and access the response from <code>Responses</code> object.<br>
        The intention of using <code>Requests</code> as the return type for <code>list</code> is to provide the capability to apply query parameters before sending the request, as shown in the <code>listWithQueryParams</code> function of the snippet below.
    </small>
    <pre>
        public class ListQuestions extends AbstractTest {

            public ListQuestions() {
                super("questions", "questions/question");
            }

            @Test
            public void listWithQueryParams() {
                Responses list = list()
                        .withQueryParam("limit", "3")
                        .withQueryParam("offset", "1").get();

                list.assertTrue(200);
            }

            @Test
            public void validList() {
                Responses listBeforeCreate = list().get();
                int countBefore = Integer.parseInt(listBeforeCreate.getParam("$.count"));

                create(); // create a resource

                Responses listAfterCreate = list().get();
                int countAfter = Integer.parseInt(listAfterCreate.getParam("$.count"));

                listBeforeCreate.assertTrue(200);
                listAfterCreate.assertTrue(200);
                Assert.assertTrue((countAfter == ++countBefore)); // verify that the list was incremented by the added resource
            }
        }
    </pre>


    <h4>
        <a name="list_token">public Requests list(String token)</a>
        <button onclick="gotoSrc('L53-L59')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#list">public Requests list()</a></code>, however it also provides a second parameter to specify the <code>token</code> used to make the request.
    </small>
    <pre>
        public class ListQuestions extends AbstractTest {

            public ListQuestions() {
                super("questions", "questions/question");
            }

            @Test
            public void createTokenShouldError() {
                Responses response = list(Token.create("questions")).get();
                response.assertTrue(403, "\"code\":\"PBERR000x789\"");
            }
        }
    </pre>


    <h4>
        <a name="create">public Responses create()</a>
        <button onclick="gotoSrc('L61-L63')">src</button>
    </h4>
    <small>
        This method is used to issue a post request for creating a new resource using the appropriate valid create token.
        The body used to create the request is obtained from the JSON file referenced by the <code>jsonData</code> in the <code><a href="#AbstractTest">public AbstractTest(String endpoint, String jsonData)</a></code> constructor.
        This method returns a <code>Responses</code> object.
    </small>
    <pre>
        public class CreateQuestion extends AbstractTest {

            public CreateQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void validCreate() {
                Responses response = create();
                response.assertTrue(200);
            }
        }
    </pre>


    <h4>
        <a name="create_body">public Responses create(String body)</a>
        <button onclick="gotoSrc('L65-L67')">src</button>
    </h4>
    <small>This method achieves the same function as <code><a href="#create">public Responses create()</a></code>, however the request body is required as an argument.</small>
    <pre>
        public class CreateQuestion extends AbstractTest {

            public CreateQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void validCreate() {
                Responses response = create(JsonHelper.getJson("questions/question"));
                response.assertTrue(200);
            }
        }
    </pre>


    <h4>
        <a name="create_bodyToken">public Responses create(String body, String token)</a>
        <button onclick="gotoSrc('L69-L76')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#create_body">public Responses create(String body)</a></code>, however a second parameter is required as the <code>token</code> used to make the request.
    </small>
    <pre>
        public class CreateQuestion extends AbstractTest {

            public CreateQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void readOnlyTokenShouldError() {
                Responses response = create(JsonHelper.getJson("questions/question"), Token.read("questions"));
                response.assertTrue(403, "\"code\":\"PBERR000x789\"");
            }
        }
    </pre>


    <h4>
        <a name="update">public Responses update(String uuid, String body)</a>
        <button onclick="gotoSrc('L78-L80')">src</button>
    </h4>
    <small>
        This method is used to issue a put request for updating an existing resource using the appropriate valid update token.
        The method requires two arguments: the <code>uuid</code> of the resource and the data, and the <code>body</code> which is the data used to update the resource.
        Also, the method internally uses <code><a href="getEtag">public String getEtag(String uuid)</a></code> to get the Etag for making the request.
        This method returns a <code>Responses</code> object.
    </small>
    <pre>
        public class UpdateQuestion extends AbstractTest {

            public UpdateQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void noStatusShouldError() {
                Responses response = update("06920c43-1349-4485-b616-1a9da42c1b64", JsonHelper.removeParam("questions/question", "$.status"));
                response.assertTrue(400, "\"code\":\"PBERR000x002\"");
            }
        }
    </pre>


    <h4>
        <a name="update_etag">public Responses update(String uuid, String body, String etag)</a>
        <button onclick="gotoSrc('L82-L84')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#update">public Responses update(String uuid, String body)</a></code>, however a third parameter is required as the <code>etag</code> used to make the request.
    </small>
    <pre>
        public class UpdateQuestion extends AbstractTest {

            String uuid = "0f53a44709a0b80ba41d7f7c11e98f49";

            public UpdateQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void wrongIfMatchShouldError() {
                Responses response = update(uuid, JsonHelper.getJson("questions/question"), "2d13a44709a0b80ba41d7f7c11e98f49");
                response.assertTrue(412, "\"code\":\"PBERR000x666\"");
            }
        }
    </pre>


    <h4>
        <a name="update_etagToken">public Responses update(String uuid, String body, String etag, String token)</a>
        <button onclick="gotoSrc('L86-L93')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#update_etag">public Responses update(String uuid, String body, String etag)</a></code>, however a fourth parameter is required as the <code>token</code> used to make the request.
    </small>
    <pre>
        public class UpdateQuestion extends AbstractTest {

            String uuid = "0f53a44709a0b80ba41d7f7c11e98f49";

            public UpdateQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void invalidTokenShouldError() {
                Responses response = update(uuid, JsonHelper.getJson("questions/question"), getEtag(uuid), "invalid.token");
                response.assertTrue(401, "\"code\":\"PBERR000x123\"");
            }
        }
    </pre>


    <h4>
        <a name="patch">public Responses patch(String uuid, String body)</a>
        <button onclick="gotoSrc('L95-L97')">src</button>
    </h4>
    <small>
        This method is used to issue a patch request for patching an existing resource using the appropriate valid update token.
        The method requires two arguments: the <code>uuid</code> of the resource and the data, and the <code>body</code> which is the data patched to the resource.
        Also, the method internally uses <code><a href="getEtag">public String getEtag(String uuid)</a></code> to get the Etag for making the request.
        This method returns a <code>Responses</code> object.
    </small>
    <pre>
        public class PatchQuestion extends AbstractTest {

            public PatchQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void noStatusShouldError() {
                Responses response = patch("06920c43-1349-4485-b616-1a9da42c1b64", JsonHelper.removeParam("questions/question", "$.status"));
                response.assertTrue(400, "\"code\":\"PBERR000x002\"");
            }
        }
    </pre>


    <h4>
        <a name="patch_etag">public Responses patch(String uuid, String body, String etag)</a>
        <button onclick="gotoSrc('L99-L101')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#patch">public Responses patch(String uuid, String body)</a></code>, however a third parameter is required as the <code>etag</code> used to make the request.
    </small>
    <pre>
        public class PatchQuestion extends AbstractTest {

            String uuid = "0f53a44709a0b80ba41d7f7c11e98f49";

            public PatchQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void invalidTokenShouldError() {
                Responses response = patch(uuid, JsonHelper.getJson("questions/question"), getEtag(uuid), "invalid.token");
                response.assertTrue(401, "\"code\":\"PBERR000x123\"");
            }
        }
    </pre>


    <h4>
        <a name="patch_etagToken">public Responses patch(String uuid, String body, String etag, String token)</a>
        <button onclick="gotoSrc('L103-L110')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#patch_etag">public Responses patch(String uuid, String body, String etag)</a></code>, however a fourth parameter is required as the <code>token</code> used to make the request.
    </small>
    <pre>
        public class PatchQuestion extends AbstractTest {

            String uuid = "0f53a44709a0b80ba41d7f7c11e98f49";

            public PatchQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void invalidTokenShouldError() {
                Responses response = patch(uuid, JsonHelper.getJson("questions/question"), getEtag(uuid), "invalid.token");
                response.assertTrue(401, "\"code\":\"PBERR000x123\"");
            }
        }
    </pre>


    <h4>
        <a name="delete">public Responses delete(String uuid)</a>
        <button onclick="gotoSrc('L112-L114')">src</button>
    </h4>
    <small>
        This method is used to issue a delete request on a resource using its <code>uuid</code> and the appropriate valid delete token.
        This method returns a <code>Responses</code> object.
    </small>
    <pre>
        public class DeleteQuestion extends AbstractTest {

            public DeleteQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void validGet() {
                Responses response = delete("06920c43-1349-4485-b616-1a9da42c1b64");
                response.assertTrue(200);
            }
        }
    </pre>


    <h4>
        <a name="delete_token">public Responses delete(String uuid, String token)</a>
        <button onclick="gotoSrc('L116-L122')">src</button>
    </h4>
    <small>
        This method achieves the same function as <code><a href="#delete">public Responses delete(String uuid)</a></code>, however it also provides a second parameter to specify the <code>token</code> used to make the request.
    </small>
    <pre>
        public class DeleteQuestion extends AbstractTest {

            public DeleteQuestion() {
                super("questions", "questions/question");
            }

            @Test
            public void readOnlyTokenShouldError() {
                Responses response = delete("06920c43-1349-4485-b616-1a9da42c1b64", Token.read("questions"));
                response.assertTrue(403, "\"code\":\"PBERR000x789\"");
            }
        }
    </pre>

</div>
<script src="scroller.js"></script>
<script>
function gotoSrc (lines) {
    var url = 'https://github.com/chinenyeze/api-tests-lib/blob/master/src/main/java/com/perkbox/testbase/AbstractTest.java#' + lines;
    var win = window.open(url, '_blank');
    win.focus();
}
</script>
</body>
</html>